<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì í˜ì´ì§€ - ì •ì›ì‚¬ë“¤ ì‹œì¦Œ10</title>
    <meta property="og:title" content="ê´€ë¦¬ì í˜ì´ì§€ - ì •ì›ì‚¬ë“¤ ì‹œì¦Œ10">
    <meta property="og:description" content="ì •ì›ì‚¬ë“¤ ì‹œì¦Œ10 í”„ë¡œì íŠ¸ ê´€ë¦¬ì í˜ì´ì§€">
    <meta property="og:image" content="/static/og-image.jpg">
    <meta property="og:url" content="https://garden10.junho85.pe.kr/admin">
    <meta property="og:type" content="website">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .admin-section {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 30px;
        }

        .admin-card {
            background-color: #f6f8fa;
            border: 1px solid #e1e4e8;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .admin-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .admin-actions {
            margin-top: 20px;
        }

        .admin-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .admin-button.danger {
            background-color: #e74c3c;
        }

        .admin-button.success {
            background-color: #2ecc71;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, 
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
        }

        .result-area {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 600px;
            overflow: auto;
            line-height: 1.5;
            font-size: 14px;
        }
        
        /* ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ ê²°ê³¼ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #prompt-result.result-area {
            background-color: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            font-family: 'Noto Sans KR', sans-serif;
            padding: 20px;
            position: relative;
        }
        
        #prompt-result.result-area::before {
            content: "ğŸ’¬ ì´ ë‚´ìš©ì„ ë³µì‚¬í•´ì„œ AI ë„êµ¬ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”";
            display: block;
            background-color: #9b59b6;
            color: white;
            padding: 8px 15px;
            margin: -20px -20px 15px -20px;
            font-weight: bold;
            border-radius: 4px 4px 0 0;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* JSON ë°ì´í„° ë³´ê¸° ì¢‹ê²Œ ìŠ¤íƒ€ì¼ë§ */
        .json-key {
            color: #f1c40f;
            font-weight: bold;
        }

        .json-string {
            color: #2ecc71;
        }

        .json-number {
            color: #3498db;
        }

        .json-boolean {
            color: #e74c3c;
        }

        /* ë¡œê·¸ ìŠ¤íƒ€ì¼ */
        .log-entry {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
            border-left: 4px solid #ddd;
        }

        .log-time {
            color: #6c757d;
            font-size: 0.85em;
        }

        .log-message {
            margin-top: 5px;
        }

        .log-level-info {
            border-left-color: #17a2b8;
        }

        .log-level-warning {
            border-left-color: #ffc107;
        }

        .log-level-error {
            border-left-color: #dc3545;
        }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }

        .tab.active {
            background-color: #fff;
            border-color: #dee2e6;
            border-bottom-color: transparent;
            color: #3498db;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        /* ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .admin-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            animation: adminFadeInOut 3s ease-in-out;
            max-width: 250px;
            font-size: 13px;
            text-align: center;
            line-height: 1.3;
            height: auto;
            max-height: 50px;
            overflow: hidden;
        }
        
        .admin-notification.error {
            background-color: #dc3545;
        }
        
        @keyframes adminFadeInOut {
            0% { opacity: 0; }
            15% { opacity: 1; }
            85% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <!-- GNB ì˜ì—­ -->
    <header class="gnb">
        <h1><a href="/">ì •ì›ì‚¬ë“¤ ì‹œì¦Œ10</a></h1>
        <div class="header-buttons">
            <a href="/" class="back-button">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            <div id="auth-container">
                <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ë™ì ìœ¼ë¡œ ë³€ê²½ë¨ -->
                <button id="login-btn" class="login-button">GitHub ë¡œê·¸ì¸</button>
                <div id="user-profile" class="user-profile hidden">
                    <img id="user-avatar" class="user-avatar" src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
                    <span id="user-name"></span>
                    <button id="logout-btn" class="logout-button">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main ì˜ì—­ -->
    <main>
        <section class="admin-section">
            <h2>ê´€ë¦¬ì í˜ì´ì§€</h2>
            <p>ì •ì›ì‚¬ë“¤ ì‹œì¦Œ10 ì„œë¹„ìŠ¤ì˜ ê´€ë¦¬ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
            <div id="access-denied" class="hidden">
                <p style="color: #e74c3c; font-weight: bold; margin-top: 20px;">
                    ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìë§Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.
                </p>
            </div>

            <div id="admin-content" class="hidden">
                <!-- íƒ­ ë©”ë‰´ -->
                <div class="tabs">
                    <div class="tab active" data-tab="attendance">ì¶œì„ ê´€ë¦¬</div>
                    <div class="tab" data-tab="system">ì‹œìŠ¤í…œ ê´€ë¦¬</div>
                    <div class="tab" data-tab="users">ì‚¬ìš©ì ê´€ë¦¬</div>
                    <div class="tab" data-tab="logs">ë¡œê·¸ í™•ì¸</div>
                    <div class="tab" data-tab="motivational">ì‘ì›ë©”ì‹œì§€</div>
                </div>

                <!-- ì¶œì„ ê´€ë¦¬ íƒ­ -->
                <div id="attendance-tab" class="tab-content active">
                    <div class="admin-card">
                        <h3>ì¶œì„ ë°ì´í„° ê°±ì‹ </h3>
                        <p>GitHub APIë¥¼ í†µí•´ ëª¨ë“  ì‚¬ìš©ìì˜ ì¶œì„ ë°ì´í„°ë¥¼ ìµœì‹  ìƒíƒœë¡œ ê°±ì‹ í•©ë‹ˆë‹¤.</p>
                        <div class="admin-actions">
                            <button id="refresh-attendance" class="admin-button success">ì¶œì„ ë°ì´í„° ê°±ì‹ </button>
                        </div>
                        <div id="refresh-result" class="hidden result-area"></div>
                    </div>

                    <div class="admin-card">
                        <h3>íŠ¹ì • ë‚ ì§œ ì¶œì„ ì²˜ë¦¬</h3>
                        <p>íŠ¹ì • ë‚ ì§œì˜ ì¶œì„ ìƒíƒœë¥¼ ìˆ˜ë™ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <div class="form-group">
                            <label for="user-select">ì‚¬ìš©ì</label>
                            <select id="user-select">
                                <option value="">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date-input">ë‚ ì§œ</label>
                            <input type="date" id="date-input">
                        </div>
                        <div class="form-group">
                            <label for="attendance-status">ì¶œì„ ìƒíƒœ</label>
                            <select id="attendance-status">
                                <option value="1">ì¶œì„</option>
                                <option value="0">ë¯¸ì¶œì„</option>
                            </select>
                        </div>
                        <div class="admin-actions">
                            <button id="update-attendance" class="admin-button">ì¶œì„ ìƒíƒœ ë³€ê²½</button>
                        </div>
                        <div id="update-result" class="hidden result-area"></div>
                    </div>
                </div>

                <!-- ì‹œìŠ¤í…œ ê´€ë¦¬ íƒ­ -->
                <div id="system-tab" class="tab-content">
                    <div class="admin-card">
                        <h3>ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                        <p>ì„œë²„ ìƒíƒœ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, API ì—°ê²° ìƒíƒœ ë“± ì‹œìŠ¤í…œ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
                        <div class="admin-actions">
                            <button id="check-system" class="admin-button">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</button>
                        </div>
                        <div id="system-result" class="hidden result-area"></div>
                    </div>

                    <div class="admin-card">
                        <h3>GitHub API ì—°ê²° í™•ì¸</h3>
                        <p>GitHub APIì™€ì˜ ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
                        <div class="admin-actions">
                            <button id="check-github" class="admin-button">GitHub API í™•ì¸</button>
                        </div>
                        <div id="github-result" class="hidden result-area"></div>
                    </div>
                </div>

                <!-- ì‚¬ìš©ì ê´€ë¦¬ íƒ­ -->
                <div id="users-tab" class="tab-content">
                    <div class="admin-card">
                        <h3>ì‚¬ìš©ì ëª©ë¡</h3>
                        <p>ì‹œìŠ¤í…œì— ë“±ë¡ëœ ëª¨ë“  ì‚¬ìš©ìë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
                        <div class="admin-actions">
                            <button id="list-users" class="admin-button">ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ</button>
                        </div>
                        <div id="users-result" class="hidden result-area"></div>
                    </div>

                    <div class="admin-card">
                        <h3>ì‚¬ìš©ì ì¶”ê°€</h3>
                        <p>GitHub IDë¡œ ìƒˆ ì‚¬ìš©ìë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.</p>
                        <div class="form-group">
                            <label for="new-github-id">GitHub ID</label>
                            <input type="text" id="new-github-id" placeholder="GitHub IDë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="admin-actions">
                            <button id="add-user" class="admin-button success">ì‚¬ìš©ì ì¶”ê°€</button>
                        </div>
                        <div id="add-user-result" class="hidden result-area"></div>
                    </div>
                </div>

                <!-- ë¡œê·¸ í™•ì¸ íƒ­ -->
                <div id="logs-tab" class="tab-content">
                    <div class="admin-card">
                        <h3>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸</h3>
                        <p>ê°€ì¥ ìµœê·¼ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
                        <div class="admin-actions">
                            <button id="view-logs" class="admin-button">ë¡œê·¸ ì¡°íšŒ</button>
                        </div>
                        <div id="logs-list" class="hidden">
                            <!-- ë¡œê·¸ í•­ëª©ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </div>
                    </div>
                </div>
                
                <!-- ì‘ì›ë©”ì‹œì§€ ì‘ì„± íƒ­ -->
                <div id="motivational-tab" class="tab-content">
                    <div class="admin-card">
                        <h3>ì‘ì›ë©”ì‹œì§€ ìƒì„±</h3>
                        <p>ì¶œì„ í˜„í™©ì„ ë°”íƒ•ìœ¼ë¡œ ì‘ì›ë©”ì‹œì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>
                        <div class="form-group">
                            <label for="prompt-template">ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸</label>
                            <textarea id="prompt-template" placeholder="ì‘ì›ë©”ì‹œì§€ ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.">ì¶œì„ ì‘ì› ë©”ì‹œì§€ ì‘ì„±í•´ì¤˜. ì˜¤ëŠ˜ì´ ëª‡ì¼ì§¸ì¸ì§€ë„ ì•Œë ¤ì¤˜. ë§ˆí¬ë‹¤ìš´ì„ ì‚¬ìš©í•˜ì§€ ë§ì•„ì¤˜.</textarea>
                            <p class="prompt-tip" style="font-size: 0.9em; color: #666; margin-top: 5px;">ğŸ’¡ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¥¼ ë³µì‚¬í•˜ì—¬ ChatGPT ë“±ì˜ AI ë„êµ¬ì— ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ë©´ ë©ë‹ˆë‹¤.</p>
                        </div>
                        <div class="admin-actions">
                            <button id="generate-prompt" class="admin-button success">í”„ë¡¬í”„íŠ¸ ìƒì„±</button>
                            <button id="copy-prompt" class="admin-button" style="background-color: #9b59b6;" disabled>í´ë¦½ë³´ë“œì— ë³µì‚¬</button>
                        </div>
                        <div id="prompt-result" class="hidden result-area"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ì¸ì¦ ìƒíƒœ í™•ì¸
            checkAuthStatus();

            // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('login-btn').addEventListener('click', function() {
                window.location.href = '/api/auth/login';
            });

            document.getElementById('logout-btn').addEventListener('click', function() {
                window.location.href = '/api/auth/logout';
            });

            // íƒ­ ì „í™˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // í™œì„± íƒ­ í´ë˜ìŠ¤ ì œê±°
                    tabs.forEach(t => t.classList.remove('active'));
                    // í˜„ì¬ íƒ­ í™œì„±í™”
                    this.classList.add('active');

                    // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                    const tabContents = document.querySelectorAll('.tab-content');
                    tabContents.forEach(content => content.classList.remove('active'));

                    // ì„ íƒí•œ íƒ­ ì»¨í…ì¸  í‘œì‹œ
                    const tabContentId = this.getAttribute('data-tab') + '-tab';
                    document.getElementById(tabContentId).classList.add('active');
                });
            });

            // ì¶œì„ ë°ì´í„° ê°±ì‹  ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('refresh-attendance').addEventListener('click', function() {
                refreshAttendance();
            });

            // ì¶œì„ ìƒíƒœ ë³€ê²½ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('update-attendance').addEventListener('click', function() {
                updateAttendance();
            });

            // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('check-system').addEventListener('click', function() {
                checkSystemStatus();
            });

            // GitHub API í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('check-github').addEventListener('click', function() {
                checkGithubApi();
            });

            // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('list-users').addEventListener('click', function() {
                listUsers();
            });

            // ì‚¬ìš©ì ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('add-user').addEventListener('click', function() {
                addUser();
            });

            // ë¡œê·¸ ì¡°íšŒ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('view-logs').addEventListener('click', function() {
                viewLogs();
            });
            
            // ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('generate-prompt').addEventListener('click', function() {
                generateMotivationalPrompt();
            });
            
            // ì‘ì›ë©”ì‹œì§€ í´ë¦½ë³´ë“œ ë³µì‚¬ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('copy-prompt').addEventListener('click', function() {
                copyPromptToClipboard();
            });

            // ì‚¬ìš©ì ëª©ë¡ ë¡œë”©
            loadUsersList();
        });

        // ì¸ì¦ ìƒíƒœ í™•ì¸
        function checkAuthStatus() {
            fetch('/api/auth/me')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ì¸ì¦ ì‹¤íŒ¨');
                    }
                    return response.json();
                })
                .then(userData => {
                    // ë¡œê·¸ì¸ ì„±ê³µ ìƒíƒœ
                    document.getElementById('login-btn').classList.add('hidden');
                    const userProfile = document.getElementById('user-profile');
                    userProfile.classList.remove('hidden');

                    // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                    document.getElementById('user-avatar').src = userData.github_profile_url;
                    document.getElementById('user-name').textContent = userData.github_id;

                    // ê´€ë¦¬ì í™•ì¸ (junho85ë§Œ ì ‘ê·¼ ê°€ëŠ¥)
                    if (userData.github_id === 'junho85') {
                        document.getElementById('admin-content').classList.remove('hidden');
                    } else {
                        document.getElementById('access-denied').classList.remove('hidden');
                    }
                })
                .catch(error => {
                    // ë¡œê·¸ì¸ ì•ˆëœ ìƒíƒœ
                    document.getElementById('login-btn').classList.remove('hidden');
                    document.getElementById('user-profile').classList.add('hidden');
                    document.getElementById('access-denied').classList.remove('hidden');
                });
        }

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ (ì‚¬ìš©ì ì„ íƒ ë“œë¡­ë‹¤ìš´ìš©)
        function loadUsersList() {
            fetch('/api/users')
                .then(response => response.json())
                .then(users => {
                    const userSelect = document.getElementById('user-select');
                    userSelect.innerHTML = '<option value="">ì‚¬ìš©ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

                    users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.github_id;
                        option.textContent = user.github_id;
                        userSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                });
        }

        // JSON ë°ì´í„°ë¥¼ í¬ë§·íŒ…í•˜ì—¬ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        function formatJSON(json) {
            if (typeof json !== 'string') {
                json = JSON.stringify(json, null, 2);
            }

            // HTML ì´ìŠ¤ì¼€ì´í”„
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

            // JSON êµ¬ë¬¸ ê°•ì¡°
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        // ì¶œì„ ë°ì´í„° ê°±ì‹ 
        function refreshAttendance() {
            const resultArea = document.getElementById('refresh-result');
            resultArea.textContent = 'ì¶œì„ ë°ì´í„° ê°±ì‹  ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/admin/refresh-attendance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                resultArea.innerHTML = formatJSON(data);
                showNotification('ì¶œì„ ë°ì´í„°ê°€ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤.', false);
            })
            .catch(error => {
                resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                showNotification('ì¶œì„ ë°ì´í„° ê°±ì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            });
        }

        // ì¶œì„ ìƒíƒœ ìˆ˜ë™ ë³€ê²½
        function updateAttendance() {
            const github_id = document.getElementById('user-select').value;
            const date = document.getElementById('date-input').value;
            const is_attended = document.getElementById('attendance-status').value === '1';

            if (!github_id || !date) {
                showNotification('ì‚¬ìš©ìì™€ ë‚ ì§œë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const resultArea = document.getElementById('update-result');
            resultArea.textContent = 'ì¶œì„ ìƒíƒœ ë³€ê²½ ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/admin/update-attendance', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    github_id: github_id,
                    date: date,
                    is_attended: is_attended
                })
            })
            .then(response => response.json())
            .then(data => {
                resultArea.innerHTML = formatJSON(data);
                showNotification('ì¶œì„ ìƒíƒœê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', false);
            })
            .catch(error => {
                resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                showNotification('ì¶œì„ ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            });
        }

        // ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
        function checkSystemStatus() {
            const resultArea = document.getElementById('system-result');
            resultArea.textContent = 'ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/admin/system-status')
                .then(response => response.json())
                .then(data => {
                    resultArea.innerHTML = formatJSON(data);
                })
                .catch(error => {
                    resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                });
        }

        // GitHub API í™•ì¸
        function checkGithubApi() {
            const resultArea = document.getElementById('github-result');
            resultArea.textContent = 'GitHub API ì—°ê²° í™•ì¸ ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/admin/check-github-api')
                .then(response => response.json())
                .then(data => {
                    resultArea.innerHTML = formatJSON(data);
                })
                .catch(error => {
                    resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                });
        }

        // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
        function listUsers() {
            const resultArea = document.getElementById('users-result');
            resultArea.textContent = 'ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/users')
                .then(response => response.json())
                .then(data => {
                    resultArea.innerHTML = formatJSON(data);
                })
                .catch(error => {
                    resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                });
        }

        // ì‚¬ìš©ì ì¶”ê°€
        function addUser() {
            const github_id = document.getElementById('new-github-id').value;

            if (!github_id) {
                showNotification('GitHub IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const resultArea = document.getElementById('add-user-result');
            resultArea.textContent = 'ì‚¬ìš©ì ì¶”ê°€ ì¤‘...';
            resultArea.classList.remove('hidden');

            fetch('/api/admin/add-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    github_id: github_id
                })
            })
            .then(response => response.json())
            .then(data => {
                resultArea.innerHTML = formatJSON(data);
                showNotification('ì‚¬ìš©ìê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', false);
                // ì‚¬ìš©ì ëª©ë¡ ë‹¤ì‹œ ë¡œë“œ
                loadUsersList();
            })
            .catch(error => {
                resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                showNotification('ì‚¬ìš©ì ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            });
        }

        // ë¡œê·¸ ì¡°íšŒ
        function viewLogs() {
            const logsList = document.getElementById('logs-list');
            logsList.innerHTML = '<p>ë¡œê·¸ ì¡°íšŒ ì¤‘...</p>';
            logsList.classList.remove('hidden');

            fetch('/api/admin/logs')
                .then(response => response.json())
                .then(logs => {
                    logsList.innerHTML = '';

                    logs.forEach(log => {
                        const logEntry = document.createElement('div');
                        logEntry.className = `log-entry log-level-${log.level.toLowerCase()}`;

                        const logTime = document.createElement('div');
                        logTime.className = 'log-time';
                        logTime.textContent = new Date(log.timestamp).toLocaleString();

                        const logMessage = document.createElement('div');
                        logMessage.className = 'log-message';
                        logMessage.textContent = `[${log.level}] ${log.message}`;

                        logEntry.appendChild(logTime);
                        logEntry.appendChild(logMessage);
                        logsList.appendChild(logEntry);
                    });

                    if (logs.length === 0) {
                        logsList.innerHTML = '<p>ì¡°íšŒëœ ë¡œê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                })
                .catch(error => {
                    logsList.innerHTML = `<p>ë¡œê·¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}</p>`;
                });
        }
        
        // ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±
        function generateMotivationalPrompt() {
            const promptTemplate = document.getElementById('prompt-template').value;
            const resultArea = document.getElementById('prompt-result');
            const copyButton = document.getElementById('copy-prompt');
            
            if (!promptTemplate) {
                showNotification('í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }
            
            resultArea.textContent = 'ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘...';
            resultArea.classList.remove('hidden');
            copyButton.disabled = true;
            
            fetch('/api/admin/generate-motivational-prompt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    prompt_template: promptTemplate
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultArea.textContent = data.prompt;
                    copyButton.disabled = false;
                    showNotification('ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ë³µì‚¬ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ AI ë„êµ¬ì— ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', false);
                } else {
                    resultArea.textContent = 'ì˜¤ë¥˜: ' + data.message;
                    copyButton.disabled = true;
                    showNotification('í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
                }
            })
            .catch(error => {
                resultArea.textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
                copyButton.disabled = true;
                showNotification('í”„ë¡¬í”„íŠ¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', true);
            });
        }
        
        // ì‘ì›ë©”ì‹œì§€ í”„ë¡¬í”„íŠ¸ í´ë¦½ë³´ë“œì— ë³µì‚¬
        function copyPromptToClipboard() {
            const promptText = document.getElementById('prompt-result').textContent;
            
            if (!promptText) {
                showNotification('ë³µì‚¬í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.', true);
                return;
            }
            
            // í´ë¦½ë³´ë“œì— ë³µì‚¬í•˜ê¸°
            navigator.clipboard.writeText(promptText)
                .then(() => {
                    showNotification('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ChatGPTë‚˜ ë‹¤ë¥¸ AI ë„êµ¬ì— ë°”ë¡œ ë¶™ì—¬ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', false);
                    
                    // ë³µì‚¬ ë²„íŠ¼ í…ìŠ¤íŠ¸ ì¼ì‹œì ìœ¼ë¡œ ë³€ê²½
                    const copyButton = document.getElementById('copy-prompt');
                    const originalText = copyButton.textContent;
                    copyButton.textContent = 'âœ… ë³µì‚¬ë¨';
                    
                    setTimeout(() => {
                        copyButton.textContent = originalText;
                    }, 2000);
                })
                .catch(err => {
                    console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    showNotification('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', true);
                });
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
        function showNotification(message, isError = false) {
            const notification = document.createElement('div');
            notification.className = isError ? 'admin-notification error' : 'admin-notification';
            notification.textContent = message;

            document.body.appendChild(notification);

            // 3ì´ˆ í›„ ì•Œë¦¼ ì œê±°
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    </script>
</body>
</html>
